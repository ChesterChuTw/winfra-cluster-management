nextcloud:
  host: nextcloud.example.com
  # Extra config files created in /var/www/html/config/
  configs:
    traefik.config.php: |-
      <?php
      $CONFIG = array (
        'overwriteprotocol' => 'https'
        );
    # 修復「轉發標頭」與「維護時段」
    security.config.php: |-
      <?php
      $CONFIG = array (
        # 修復：轉發標頭 (紅色錯誤)
        # 允許 Nextcloud 信任來自 K8s 內部網段的流量 (Ingress Controller)
        'trusted_proxies' => array(
          0 => '10.0.0.0/8',      # 涵蓋大範圍 K8s 內部 IP
          1 => '172.16.0.0/12',   # 常見的 Docker/K8s 網段
          2 => '192.168.0.0/16',  # 常見的區網網段
        ),
        'forwarded_for_headers' => array('HTTP_X_FORWARDED_FOR'),
        
        # 修復：維護時段 (黃色警告)
        # 設定為凌晨 01:00 UTC (台灣時間 09:00 AM，可自行調整數值)
        'maintenance_window_start' => 1,
        
        # 設定預設電話區域，避免之後出現相關警告
        'default_phone_region' => 'TW',
      );

# 修復：客戶端推播 (黃色警告)
# 啟用 High Performance Backend for Files
notify_push:
  enabled: true

persistence:
  enabled: true
  # existingClaim: nextcloud-nextcloud
  nextcloudData:
    enabled: true
    # existingClaim: nextcloud-nextcloud-data
    size: 8Gi

internalDatabase:
  enabled: false

externalDatabase:
  enabled: false

mariadb:
  enabled: true
  primary:
    persistence:
      enabled: true
  image:
    repository: bitnamilegacy/mariadb
  tls:
    enabled: true
    autoGenerated:
      enabled: true

global:
  security:
    allowInsecureImages: true

startupProbe:
  enabled: true
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 10
  failureThreshold: 120

livenessProbe:
  initialDelaySeconds: 10
  periodSeconds: 10
  timeoutSeconds: 10
  failureThreshold: 12

readinessProbe:
  initialDelaySeconds: 10
  periodSeconds: 10
  timeoutSeconds: 10
  failureThreshold: 30
